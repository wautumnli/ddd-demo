# DDD模型与设计思路

![image-20220214151625359](/Users/autumnliw/Desktop/WQL Coding/ddd-demo/typora/image-20220214151625359.png)

# 战略设计

## 领域划分

## 寻找限界上下文（BC）

## 确定上下文映射

# 战术设计

![image-20220214151356603](/Users/autumnliw/Desktop/WQL Coding/ddd-demo/typora/image-20220214151356603.png)

# 领域故事分析

使用Domain-story-modeler

举例：售卖机扫码支付购物的领域故事分析

![image-20220214153816006](/Users/autumnliw/Desktop/WQL Coding/ddd-demo/typora/image-20220214153816006.png)

# 关注点分离

# 领域划分和子域

# 防腐层

## 防腐层的构建

# 传统方式的问题

- 领域模型被省略，变成贫血模型

- 容易演变成基于数据的设计，一切从表结构开始

- 领域模型与技术实现混杂，易被技术实现绑架

# DDD传统四层架构

- 接口层 interface，外部通信，接口访问

- 应用层 application，事物控制，事件订阅，资源库读写

- 领域层 domain，核心，领域模型，设计，工厂

- 基础设施层 infrastructure，通用框架，工具

![image-20220214164728407](/Users/autumnliw/Desktop/WQL Coding/ddd-demo/typora/image-20220214164728407.png)

# 依赖倒置和洋葱六边形架构

## 模型图

![image-20220214164803664](/Users/autumnliw/Desktop/WQL Coding/ddd-demo/typora/image-20220214164803664.png)

## 上下文代码架构层次

![image-20220214175457697](/Users/autumnliw/Desktop/WQL Coding/ddd-demo/typora/image-20220214175457697.png)

# 实体和值对象

## 定义

需要以ID来跟踪状态变化的对象为实体，否则为值对象

标识符相等的为实体，属性相等的为值对象

## 为什么要区分实体和值对象

- 值对象往往更轻量级
- 值对象不用跟踪变化
- 实体和值对象在领域中扮演的角色不一样

## 分辨实体和值对象

- 是否只读
- 生命周期是否跨越活动

# 资源库

# 领域事件为什么这么重要？

- 领域事件驱动建模
- 领域事件和很多重要思想相关

# 事件命名和基本属性

## 命名方法

名词 + 动词过去式

## 事件id

## 事件发生事件

# 发布和订阅方式

## 外部系统

- API定向通知
- API定时拉取
- 消息队列

## 内部系统

- 观察者模式
- 数据库流水
- 消息队列

# 事件存储

## 使用中间件存储

- 冗余机制
- 做好备份

## 基于数据库

- mongodb
- postgresql
- mysql

最好是分布式，做好时间分区

# 事件处理要求

## 顺序性

- 聚合ID
- 存储分片
- 消费分组

## 幂等性

用幂等性代替分布式事务，状态判断和去重

# 领域事件和大数据分析

![image-20220215110615842](/Users/autumnliw/Desktop/WQL Coding/ddd-demo/typora/image-20220215110615842.png)

# 什么是事件风暴

- 一种**协作式**的对复杂业务领域进行探索的讨论形式
- 一种**灵活易调整**的**轻量级**的适用于DDD的建模方法

# 事件风暴的应用场景

- 评估已有业务线的健康度并发现其优点
- 探索一个新业务的模型可行性
- 设想为各个参与方能带来最大利益的新服务
- 设计整洁的可维护的软件以支持快速推进的业务

# 事件风暴核心词汇

- 领域事件
- 聚合
- 决策命令
- 角色
- 读模型
- 策略

# DDD与微服务

## 微服务的好处

- 技术异构性
- 容错性
- 灵活扩展
- 简化部署
- 与组织架构匹配
- 可组合性
- 方便替代和升级
